<html>
	<head>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=default'></script>
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
		<style>
			h1 {
				text-align: center;
			}

			.container {
				margin: 0 auto;
				padding: 60px 20%;
			}

			figure {
				text-align: center;
			}

			img {
				display: inline-block;
			}

			body {
				font-family: 'Inter', sans-serif;
			}
		</style>
	</head>
	<body>
		<div class="container">
		<h1>CS184/284A Spring 2025 Homework 3 Write-Up</h1>
		<div style="text-align: center;">Names: Hannes Rodriguez</div>

		<br>

		Link to webpage: <a href="https://cal-cs184-student.github.io/hw-webpages-monster/hw3/index.html">https://cal-cs184-student.github.io/hw-webpages-monster/hw3/index.html</a>
		Link to GitHub repository: <a href="https://github.com/cal-cs184-student/sp25-hw3-moncel.git">https://github.com/cal-cs184-student/sp25-hw3-moncel.git</a>
		
		<figure>
			<img src="cornell.png" alt="Cornell Boxes with Bunnies" style="width:70%"/>
			<figcaption></figcaption>
		</figure>

		<!--
		We've already added one heading per part, to make your write-up as navigable when grading. Please fit your write-up within these sections!
		-->

		<h2>Overview</h2>
		Give a high-level overview of what you implemented in this homework. Think about what you've built as a whole. Share your thoughts on what interesting things you've learned from completing the homework.

		<h2>Part 1: Ray Generation and Scene Intersection</h2>
		Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="cornell.png" width="400px"/>
				  <figcaption>Caption goes here.</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="cornell.png" width="400px"/>
				  <figcaption>Caption goes here.</figcaption>
				</td>
			  </tr>
			  <tr>
				<td style="text-align: center;">
				  <img src="cornell.png" width="400px"/>
				  <figcaption>Caption goes here.</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="cornell.png" width="400px"/>
				  <figcaption>Caption goes here.</figcaption>
				</td>
			  </tr>
			</table>
		</div>
		
		<h2>Part 2: Bounding Volume Hierarchy</h2>
		Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

		<h2>Part 3: Direct Illumination</h2>
		Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

		<h2>Part 4: Global Illumination</h2>
			In my implementation of indirect lighting, I first determine if direct lighting should be included based on the accumulation setting. Then I check if we've reached the maximum ray depth, using russian roulette termination to efficiently handle arbitrarily long paths. I then sample a new direction based on the material's BSDF and create a new ray and trace it into the scene. Then I recursively compute illumination from the next bounce, before applying the rendering equation to combine all contributions. In the no accumulation renders of the second and third bounces, we see only the indirect lighting of the scene. For the second bounce, we see color bleeding from teh walls onto the bunny, soft shadows in areas that do no recieve direct light, and ambient occlusion in corners and crevices. In the third bounce we see colors blend through multiple surface interaction, light penetrate deeper into the corners, and caustic-like patterns fro light focused through mulitple reflections.Traditional rasterization cannot naturally model these indirect lighting effects because it only considers direct relationships between lights and surfaces, not considering paths with multiple bounces, so ambient occlusion must be approximated. When looking at multiple different sample rates, we see that the reduction in noise and improvement in light/shadow boundaries and gradients are not linear with the increase of the sample rate. W see a uch larger imporvement from 1 to 64 samples than from 64 to 1024 samples, while the render time continues to increase significantly with each step higher of samples. The accumlulated bouunce images give more and more realistic views of a scene, with all of the rays from each bounce adding up to make a realistic image, whereas the unacculumated images depict what each layer of light ray bounces is contributing to the image. Direct lighting creates hard boundaries between illuminated areas and shadows with no color bleeding. Indirect illumination only shows the color bleeding and soft lighting charateristics in a more uniformly lit environment.
		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="bunnypart4m100.png" width="400px"/>
				  <figcaption>global illumination bunny</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="wallepart4rr.png" width="400px"/>
				  <figcaption>global illumination walle</figcaption>
				</td>
			  </tr>
			  <tr>
				<td style="text-align: center;">
				  <img src="spherespart4rr.png" width="400px"/>
				  <figcaption>global illumination spheres</figcaption>
				</td>
			  </tr>
			</table>
		</div>
		
		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="spherespart4indirect.png" width="400px"/>
				  <figcaption>Spheres with only indirect lighting</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="spherespart4direct.png" width="400px"/>
				  <figcaption>Spheres with only direct lighting</figcaption>
				</td>
			  </tr>
			</table>
		</div>	
		
		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="bunnypart4acc0.png" width="400px"/>
				  <figcaption>Cornell bunny with accumulation, 0 max ray depth</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="bunnypart4acc1.png" width="400px"/>
				  <figcaption>Cornell bunny with accumulation, 1 max ray depth</figcaption>
				</td>
			  </tr>
			  <tr>
				<td style="text-align: center;">
				  <img src="bunnypart4acc2.png" width="400px"/>
				  <figcaption>Cornell bunny with accumulation, 2 max ray depth</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="bunnypart4acc3.png" width="400px"/>
				  <figcaption>Cornell bunny with accumulation, 3 max ray depth</figcaption>
				</td>
			  </tr>
			</table>
		</div>
		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="bunnypart4acc4.png" width="400px"/>
				  <figcaption>Cornell bunny with accumulation, 4 max ray depth</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="bunnypart4acc5.png" width="400px"/>
				  <figcaption>Cornell bunny with accumulation, 5 max ray depth</figcaption>
				</td>
			  </tr>
			  <tr>
				<td style="text-align: center;">
				  <img src="bunnypart4noacc0.png" width="400px"/>
				  <figcaption>Cornell bunny without accumulation, 0 max ray depth</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="bunnypart4noacc1.png" width="400px"/>
				  <figcaption>Cornell bunny without accumulation, 1 max ray depth</figcaption>
				</td>
			  </tr>
			</table>
		</div>
		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="bunnypart4noacc2.png" width="400px"/>
				  <figcaption>Cornell bunny without accumulation, 2 max ray depth</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="bunnypart4noacc3.png" width="400px"/>
				  <figcaption>Cornell bunny without accumulation, 3 max ray depth</figcaption>
				</td>
			  </tr>
			  <tr>
				<td style="text-align: center;">
				  <img src="bunnypart4noacc4.png" width="400px"/>
				  <figcaption>Cornell bunny without accumulation, 4 max ray depth</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="bunnypart4noacc5.png" width="400px"/>
				  <figcaption>Cornell bunny without accumulation, 5 max ray depth</figcaption>
				</td>
			  </tr>
			</table>
		</div>

		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="bunnypart4m0.png" width="400px"/>
				  <figcaption>Bunny with russian roulette rendering max ray depth 0</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="bunnypart4m1.png" width="400px"/>
				  <figcaption>Bunny with russian roulette rendering max ray depth 1</figcaption>
				</td>
			  </tr>
			  <tr>
				<td style="text-align: center;">
				  <img src="bunnypart4m2.png" width="400px"/>
				  <figcaption>Bunny with russian roulette rendering max ray depth 2</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="bunnypart4m3.png" width="400px"/>
				  <figcaption>Bunny with russian roulette rendering max ray depth 3</figcaption>
				</td>
			  </tr>
			</table>
		</div>

		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="bunnypart4m4.png" width="400px"/>
				  <figcaption>Bunny with russian roulette rendering max ray depth 4</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="bunnypart4m100.png" width="400px"/>
				  <figcaption>Bunny with russian roulette rendering max ray depth 100</figcaption>
				</td>
			  </tr>
			</table>
		</div>

		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="bunnypart4s1.png" width="400px"/>
				  <figcaption>Bunny with 1 sample per pixel max ray depth 4</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="bunnypart4s2.png" width="400px"/>
				  <figcaption>Bunny with 2 samples per pixel max ray depth 4</figcaption>
				</td>
			  </tr>
			  <tr>
				<td style="text-align: center;">
				  <img src="bunnypart4s4.png" width="400px"/>
				  <figcaption>Bunny with 4 samples per pixel max ray depth 4</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="bunnypart4s8.png" width="400px"/>
				  <figcaption>Bunny with 8 samples per pixel max ray depth 4</figcaption>
				</td>
			  </tr>
			</table>
		</div>

		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="bunnypart4s16.png" width="400px"/>
				  <figcaption>Bunny with 16 samples per pixel max ray depth 4</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="bunnypart4s64.png" width="400px"/>
				  <figcaption>Bunny with 64 samples per pixel max ray depth 4</figcaption>
				</td>
			  </tr>
			  <tr>
				<td style="text-align: center;">
				  <img src="bunnypart4s1024.png" width="400px"/>
				  <figcaption>Bunny with 1024 samples per pixel max ray depth 4</figcaption>
				</td>
			  </tr>
			</table>
		</div>




			
		<h2>Part 5: Adaptive Sampling</h2>
			Adaptive sampling is a technique to make renders faster while maintaining image quality where instead of using a fixed number of samples per pixel, adaptive sampling uses more samples in complex regions (areas with high variance) and fewer samples in simpler regions (like flat surfaces with consistent color). By monitoring each pixel's convergence individually, we stop sampling once a pixel has "good enough" quality, saving computation while maintaining image quality. In my implementation, I process samples in batches to avoid checking convergence after every single sample while tracking statistics that evaluate convergence for each sample. After each batch, I check if the pixel has converged using a statstical confidence interval. When this uncertainty is small enough relative to the pixel's brightness (with adjustment for very dark pixels), we can stop sampling. Finally, I compute the final pixel color and record how many samples were used.
		<div style="display: flex; flex-direction: column; align-items: center;">
			<table style="width: 100%; text-align: center; border-collapse: collapse;">
			  <tr>
				<td style="text-align: center;">
				  <img src="bunnypart5.png" width="400px"/>
				  <figcaption>Render of bunny in cornell box (2048 samples per pixel, 1 sample per light, max ray depth 5)</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="bunnypart5_rate.png" width="400px"/>
				  <figcaption>Sampling rate for bunny in cornell box with adaptive sampling (2048 samples per pixel, 1 sample per light, max ray depth 5)</figcaption>
				</td>
			  </tr>
			  <tr>
				<td style="text-align: center;">
				  <img src="spherespart5.png" width="400px"/>
				  <figcaption>Render for spheres in a cornell box (2048 samples per pixel, 1 sample per light, max ray depth 5)</figcaption>
				</td>
				<td style="text-align: center;">
				  <img src="spherespart5_rate.png" width="400px"/>
				  <figcaption>Sample rate for spheres in cornell box (2048 samples per pixel, 1 sample per light, max ray depth 5)</figcaption>
				</td>
			  </tr>
			</table>
		</div>
		</div>
	</body>
</html>
